<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Charity Profile - FoodShare</title>
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&family=Noto+Sans:wght@400;500;700;900&display=swap" rel="stylesheet"/>
  <style>
    body {
      margin: 0;
      font-family: 'Manrope', 'Noto Sans', Arial, sans-serif;
      background: #f9fcf8;
      color: #111b0e;
    }
    header {
      background: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 40px;
      border-bottom: 1px solid #ddd;
      position: relative;
      z-index: 2;
    }
    .logo {
      font-weight: bold;
      font-size: 18px;
      color: #54d12b;
    }
    nav a {
      margin-left: 30px;
      text-decoration: none;
      color: #333;
      font-size: 14px;
      font-weight: 500;
    }
    .sign-up-btn {
      background-color: #54d12b;
      color: white;
      padding: 8px 18px;
      border: none;
      border-radius: 20px;
      font-weight: bold;
      cursor: pointer;
      margin-left: 30px;
    }
    .flex {
      display: flex;
      min-height: 100vh;
    }
    /* Sidebar */
    .sidebar {
      width: 250px;
      padding: 32px 24px;
      border-right: 1px solid #eaf3e7;
      background: #fff;
      display: none;
      position: fixed;
      top: 70px;
      left: 0;
      height: calc(100vh - 70px);
      z-index: 1;
    }
    @media (min-width: 1024px) {
      .sidebar {
        display: block;
      }
    }
    .sidebar .logo {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 32px;
      color: #54d12b;
    }
    .sidebar nav {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .sidebar nav a {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 20px;
      border-radius: 999px;
      background: none;
      color: #222;
      font-size: 15px;
      font-weight: 500;
      text-decoration: none;
      transition: background 0.2s, color 0.2s;
    }
    .sidebar nav a.active,
    .sidebar nav a:hover {
      background: #eaf3e7;
      color: #54d12b;
      font-weight: 700;
    }
    /* Main Content */
    .main-content {
      flex: 1;
      padding: 0;
      max-width: 100vw;
      margin: 0;
      margin-left: 320px;
      margin-top: 70px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: none;
      border-radius: 0;
      box-shadow: none;
      padding: 0;
      width: 100%;
    }
    h2 {
      color: #54D12B;
      margin-bottom: 30px;
      text-align: center;
    }
    .info { margin-bottom: 24px; }
    .verified { color: #54D12B; font-weight: bold; }
    .not-verified { color: #e67e22; font-weight: bold; }
    label { display: block; margin-bottom: 8px; color: #333; font-weight: bold; }
    input, textarea { width: 100%; padding: 10px; margin-bottom: 22px; border: 1px solid #ccc; border-radius: 5px; font-size: 15px; box-sizing: border-box; }
    .submit-btn { background: #54D12B; color: #fff; border: none; border-radius: 20px; padding: 12px 0; width: 100%; font-size: 16px; font-weight: bold; cursor: pointer; transition: background 0.2s; }
    .submit-btn:hover { background: #43a81a; }
    .back-link { display: block; text-align: center; margin-top: 18px; color: #54D12B; text-decoration: none; font-size: 15px; }
    .back-link:hover { text-decoration: underline; }
    /* Profile Styles */
    .profile-header {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      padding: 32px 0 16px 0;
      border-bottom: 1px solid #eaf3e7;
      background: #fff;
      border-radius: 18px 18px 0 0;
      position: relative;
      width: 100%;
      min-width: 600px;
      min-height: 260px;
    }
    .profile-banner {
      width: 100%;
      height: 220px;
      background: linear-gradient(90deg, #54d12b 0%, #a8e063 100%);
      border-radius: 18px 18px 0 0;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 0;
    }
    .profile-avatar {
      width: 160px;
      height: 160px;
      border-radius: 50%;
      border: 4px solid #fff;
      object-fit: cover;
      position: relative;
      top: 120px;
      left: 64px;
      background: #eee;
      z-index: 1;
    }
    .profile-info {
      margin-top: 110px;
      margin-left: 64px;
      z-index: 2;
      position: relative;
    }
    .profile-info h2 {
      margin: 0 0 6px 0;
      font-size: 38px;
      font-weight: 800;
      color: #222;
    }
    .profile-info .verified {
      font-size: 15px;
      margin-left: 8px;
      color: #54D12B;
      font-weight: 700;
    }
    .profile-info .not-verified {
      font-size: 15px;
      margin-left: 8px;
      color: #e67e22;
      font-weight: 700;
    }
    .profile-details {
      margin: 24px 0 0 64px;
      font-size: 20px;
      color: #444;
      line-height: 1.7;
    }
    .profile-actions {
      margin: 24px 0 0 64px;
    }
    .profile-actions .submit-btn {
      width: auto;
      min-width: 180px;
      padding: 10px 28px;
      font-size: 16px;
      border-radius: 999px;
    }
    .profile-verify-form {
      margin: 32px 0 0 64px;
      background: #f9fcf8;
      border-radius: 12px;
      padding: 24px 24px 12px 24px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.03);
      max-width: 600px;
    }
    .profile-verify-form label {
      font-size: 15px;
      margin-bottom: 4px;
    }
    .profile-verify-form input,
    .profile-verify-form textarea {
      font-size: 18px;
      padding: 14px;
      margin-bottom: 16px;
      border-radius: 8px;
    }
    @media (max-width: 900px) {
      .main-content {
        margin-left: 0;
        margin-top: 70px;
        padding: 0;
      }
      .profile-header, .profile-details, .profile-actions, .profile-verify-form {
        margin-left: 4vw;
        margin-right: 4vw;
      }
      .container {
        max-width: 100vw;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">üç¥ FoodShare</div>
    <nav>
      <a href="../BrowseCharities.html">Browse Charities</a>
      <a href="../Donate.html">Donate</a>
      <a href="#" class="sign-up-btn" onclick="signOut()">Sign Out</a>
    </nav>
  </header>
  <div class="flex">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">FoodShare</div>
      <nav>
        <a href="CharityDashboard.html">Dashboard</a>
        <a href="#">Requests</a>
        <a href="#">Donations</a>
        <a href="#">Beneficiaries</a>
        <a href="Profile.html" class="active">Profile</a>
      </nav>
    </aside>
    <!-- Main Content -->
    <div style="flex:1;display:flex;flex-direction:column;min-height:100vh;">
      <main class="main-content">
        <div class="container" style="padding:0;box-shadow:none;background:none;max-width:700px;">
          <div class="profile-header">
            <div class="profile-banner"></div>
            <img src="https://ui-avatars.com/api/?name=Charity+Org&background=54d12b&color=fff&size=128" id="profileAvatar" class="profile-avatar" alt="Avatar" />
            <div class="profile-info">
              <h2 id="charityName"></h2>
              <span id="verifyStatus"></span>
            </div>
          </div>
          <div class="profile-details" id="profileDetails"></div>
          <div class="profile-actions" id="profileActions"></div>
          <div id="verifySection"></div>
        </div>
        <a href="CharityDashboard.html" class="back-link" style="margin-left:32px;">‚Üê Back to Dashboard</a>
      </main>
    </div>
  </div>
  <script>
    function signOut() {
      window.location.href = "../Login.html";
    }
    // Simulate JWT in localStorage: {token: ..., verified: true/false, name: ...}
    function getJWT() {
      let jwt = localStorage.getItem('jwt');
      if (!jwt) return null;
      try { return JSON.parse(jwt); } catch { return null; }
    }
    function setJWT(jwt) {
      localStorage.setItem('jwt', JSON.stringify(jwt));
    }
    // Display name and status
    const jwt = getJWT() || { name: localStorage.getItem('charityName') || 'Charity Org', verified: false };
    document.getElementById('charityName').textContent = jwt.name;
    document.getElementById('profileAvatar').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(jwt.name || 'Charity Org')}&background=54d12b&color=fff&size=128`;
    document.getElementById('verifyStatus').innerHTML = jwt.verified ? '<span class="verified">Verified</span>' : '<span class="not-verified">Not Verified</span>';
    // Profile details
    let details = '';
    if (jwt.address) details += `<div><b>Address:</b> ${jwt.address}</div>`;
    if (jwt.contact) details += `<div><b>Contact:</b> ${jwt.contact}</div>`;
    if (jwt.desc) details += `<div><b>Description:</b> ${jwt.desc}</div>`;
    document.getElementById('profileDetails').innerHTML = details;
    // Verification section
    const verifySection = document.getElementById('verifySection');
    if (!jwt.verified) {
      verifySection.innerHTML = `
        <div class="profile-actions"><button class="submit-btn" onclick="showVerifyForm()">Verify Account</button></div>
        <form id="verifyForm" class="profile-verify-form" style="display:none;" enctype="multipart/form-data">
          <label for="idUpload">Upload National ID</label>
          <input type="file" id="idUpload" name="idUpload" accept="image/*,.pdf" required />
          <label for="certUpload">Upload Organization Certificate</label>
          <input type="file" id="certUpload" name="certUpload" accept="image/*,.pdf" required />
          <label for="address">Organization Address</label>
          <input type="text" id="address" name="address" required />
          <label for="contact">Contact Phone/Email</label>
          <input type="text" id="contact" name="contact" required />
          <label for="desc">Organization Description</label>
          <textarea id="desc" name="desc" required></textarea>
          <button type="submit" class="submit-btn">Submit Verification</button>
        </form>
      `;
    }
    function showVerifyForm() {
      document.getElementById('verifyForm').style.display = 'block';
    }
    // Handle verification form
    document.addEventListener('submit', async function(e) {
      if (e.target && e.target.id === 'verifyForm') {
        e.preventDefault();
        const form = document.getElementById('verifyForm');
        const formData = new FormData(form);
        formData.append('charityName', jwt.name);
        try {
          const response = await fetch('http://localhost:3000/api/verify-charity', {
            method: 'POST',
            body: formData
          });
          if (response.ok) {
            alert('Verification submitted! Your documents and info have been sent for review.');
            // Optionally update local status
            jwt.verified = false;
            jwt.address = form.address.value;
            jwt.contact = form.contact.value;
            jwt.desc = form.desc.value;
            setJWT(jwt);
            // Hide verify button and form after submission
            const actions = document.querySelector('.profile-actions');
            if (actions) actions.style.display = 'none';
            form.style.display = 'none';
            // Optionally, update status text
            document.getElementById('verifyStatus').innerHTML = '<span class="not-verified">Verification Pending</span>';
          } else {
            alert('Failed to submit verification. Please try again.');
          }
        } catch (err) {
          alert('Network error. Please try again.');
        }
      }
    });
  </script>
</body>
</html>
